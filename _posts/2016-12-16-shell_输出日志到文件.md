---
layout: post
title: Mac shell 输出日志到文件
date: 2016-12-16 16:30:30
categories: shell
tags: mac shell tee
excerpt: 使用 echo "Hello" > log.txt 保存日志，会覆盖之前的 log.txt
thread: 20161216163030
author: 大海明月
authorQQ: 593705098
authorEmail: zengfeng75@qq.com
thumbnail:

sh: false
sh_csharp: true
---

<p> </p>
<h2 class="nav1">使用 &gt; 保存日志，会覆盖之前的 log.txt </h2>
<pre>
echo "Hello" > log.txt
</pre>
<p> </p>

<h2>log.txt 内容</h2>
<pre>
Hello
</pre>
<p> </p>
<p> </p>



<h2 class="nav1">使用 &gt;&gt; 保存日志到 log.txt 末尾叠加  </h2>
<pre>
echo "Hello1" >> log.txt
echo "Hello2" >> log.txt
</pre>
<p> </p>

<h2>log.txt 内容</h2>
<pre>
Hello1
Hello2
</pre>
<p> </p>
<p> </p>

<p>但是如果有错误日志输出时，你的信息就不完整</p>
<pre>
MacServerdeiMac:version.git macserver$ git pull origin osx > log.txt
From 127.0.0.1:repositories/kcj.version
 * branch            osx        -> FETCH_HEAD
error: Your local changes to the following files would be overwritten by merge:
	README.md
Please, commit your changes or stash them before you can merge.
Aborting
</pre>
<p> </p>

<h2>log.txt 内容</h2>
<pre>
Updating 897951b..4884c9d

</pre>
<p> </p>
<p> </p>

<p>我们就需要用到下面的方式</p>
<h2 class="nav1">使用 2&gt;&1 | tee log.txt  保存日志，会覆盖之前的 log.txt </h2>
<pre>
git pull origin osx 2>&1 | tee log.txt
</pre>
<p> </p>

<h2>log.txt 内容</h2>
<pre>
From 127.0.0.1:repositories/kcj.version
 * branch            osx        -> FETCH_HEAD
error: Your local changes to the following files would be overwritten by merge:
	README.md
Please, commit your changes or stash them before you can merge.
Aborting
Updating 897951b..4884c9d

</pre>
<p> </p>
<p> </p>


<h2 class="nav1">使用 2&gt;&1 | tee -a log.txt  保存日志到 log.txt 末尾叠加  </h2>
<pre>
git pull origin osx 2>&1 | tee -a log.txt
</pre>
<p> </p>

<h2>log.txt 内容</h2>
<pre>
From 127.0.0.1:repositories/kcj.version
 * branch            osx        -> FETCH_HEAD
error: Your local changes to the following files would be overwritten by merge:
	README.md
Please, commit your changes or stash them before you can merge.
Aborting
Updating 897951b..4884c9d
From 127.0.0.1:repositories/kcj.version
 * branch            osx        -> FETCH_HEAD
error: Your local changes to the following files would be overwritten by merge:
	README.md
Please, commit your changes or stash them before you can merge.
Aborting
Updating 897951b..4884c9d


</pre>
<p> </p>
<p> </p>


<h2 class="nav1">原理  </h2>
<p>在了解重定向之前，我们先来看看linux 的文件描述符。</p>
<p> </p>
<p> </p>

<p>linux文件描述符：可以理解为linux跟踪打开文件，而分配的一个数字，这个数字有点类似c语言操作文件时候的句柄，通过句柄就可以实现文件的读写操作。 用户可以自定义文件描述符范围是：3-num,这个最大数字，跟用户的：ulimit –n 定义数字有关系，不能超过最大值。 </p>
<p> </p>
<p> </p>


<p>linux启动后，会默认打开3个文件描述符，分别是：标准输入standard input 0,正确输出standard output 1,错误输出：error output 2 </p>
<p> </p>
<p> </p>


<p>以后打开文件后。新增文件绑定描述符 可以依次增加。 一条shell命令执行，都会继承父进程的文件描述符。因此，所有运行的shell命令，都会有默认3个文件描述符。  </p>
<p> </p>
<p> </p>



<p>对于任何一条linux 命令执行，它会是这样一个过程：  </p>
<p> </p>
<p><img src="/assets/docpic/shell_tee_1.png" /> </p>

<p>
一个命令执行了： <br>
先有一个输入：输入可以从键盘，也可以从文件得到 <br>
命令执行完成：成功了，会把成功结果输出到屏幕：standard output默认是屏幕 <br>
命令执行有错误：会把错误也输出到屏幕上面：standard error默认也是指的屏幕 <br>
</p>

<p> </p>
<p> </p>


<p>文件输入输出由追踪为一个给定的进程所有打开文件的整数句柄来完成。这些数字值就是文件描述符。最为人们所知的文件米描述符是 stdin, stdout 和 stderr，文件描述符的数字分别是0，1和2。这些数字和各自的设备是保留的。一个命令执行前，先会准备好所有输入输出，默认分别绑定（stdin,stdout,stderr)，如果这个时候出现错误，命令将终止，不会执行。命令解析过程，可以参考：Linux Shell 通配符、元字符、转义符使用实例介绍 </p>
<p> </p>
<p> </p>


<p>这些默认的输出，输入都是linux系统内定的，我们在使用过程中，有时候并不希望执行结果输出到屏幕。我想输出到文件或其它设备。这个时候我们就需要进行输出重定向了。  </p>
<p> </p>
<p> </p>

<h2 class="nav2">linux shell下常用输入输出操作符是：   </h2>

<pre>
	
1. 标准输入 (stdin) ：代码为 0 ，使用 &lt; 或 &lt;&lt; ； /dev/stdin -&gt; /proc/self/fd/0 0代表：/dev/stdin 

2. 标准输出 (stdout)：代码为 1 ，使用 &gt; 或 &gt;&gt; ； /dev/stdout -&gt; /proc/self/fd/1 1代表：/dev/stdout 

3. 标准错误输出(stderr)：代码为 2 ，使用 2&gt; 或 2&gt;&gt; ； /dev/stderr -&gt; /proc/self/fd/2 2代表：/dev/stderr 

</pre>
<p> </p>
<p> </p>



<h2 class="nav1">相关文档</h2>
<p><a target="_blank" href="http://liubin.blog.51cto.com/282313/131298"> tee 命令详解</a></p>
<p><a target="_blank" href="http://www.jb51.net/LINUXjishu/32566.html">linux shell数据重定向（输入重定向与输出重定向）详细分析</a></p>
<p></p>
<p></p>

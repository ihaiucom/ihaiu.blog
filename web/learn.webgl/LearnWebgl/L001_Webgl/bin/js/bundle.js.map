{"version":3,"file":"bundle.js","sources":["../../src/Resource.ts","../../src/Main.ts"],"sourcesContent":["export class Resource\r\n{\r\n    static Load(url: string, callback:Function, callobject?:any)\r\n    {\r\n        var http = new XMLHttpRequest();\r\n        http.open(\"get\", url, true);\r\n        http.onerror = function (e: any): void {\r\n            console.error(\"加载error\",e, url)\r\n        }\r\n        http.onabort = function (e: any): void {\r\n            \r\n            console.warn(\"加载中止\",e, url)\r\n        }\r\n        http.onprogress = function (e: any): void {\r\n            \r\n        }\r\n        http.onload = function (e: any): void {\r\n            var status: number = http.status !== undefined ? http.status : 200;\r\n\r\n            if (status === 200 || status === 204 || status === 0) \r\n            {\r\n                var data = http.response || http.responseText;\r\n                if(callobject)\r\n                {\r\n                    callback.call(callobject, data);\r\n                }\r\n                else\r\n                {\r\n                    callback(data);\r\n                }\r\n            } \r\n            else \r\n            {\r\n                console.error(\"[\" + http.status + \"]\" + http.statusText + \":\" + http.responseURL);\r\n            }\r\n            \r\n        }\r\n        http.send( );\r\n    }\r\n\r\n    static async LoadAsync(url: string): Promise<any>\r\n    {\r\n        return new Promise((resole)=>\r\n        {\r\n            this.Load(url, (data)=>\r\n            {\r\n                resole(data);\r\n            })\r\n        })\r\n    }\r\n\r\n    static async LoadShaderAsync(url: string)\r\n    {\r\n        var code = await this.LoadAsync(url);\r\n        code = code.replace(/\\r/g, \"\");\r\n        return code;\r\n    }\r\n\r\n    \r\n}","import { Resource } from \"./Resource\";\r\n\r\nvar canvas: HTMLCanvasElement;\r\nvar gl: WebGLRenderingContext;\r\nvar program: WebGLProgram;\r\n\r\nvar width = 500;\r\nvar height = 300;\r\n\r\nfunction createCanvas()\r\n{\r\n    canvas = document.createElement(\"canvas\");\r\n    var style:CSSStyleDeclaration = canvas.style;\r\n    style.backgroundColor = \"#000000\";\r\n    // style.width = width + \"px\";\r\n    // style.height = height + \"px\";\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    gl = canvas.getContext(\"webgl\");\r\n    document.body.appendChild(canvas);\r\n    \r\n    window['gl'] = gl;\r\n    window['canvas'] = canvas;\r\n}\r\n\r\nfunction resetSize()\r\n{\r\n    width = window.innerWidth;\r\n    height = window.innerHeight;\r\n    \r\n    // var style:CSSStyleDeclaration = canvas.style;\r\n    // style.width = width + \"px\";\r\n    // style.height = height + \"px\";\r\n\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    // console.log(width, canvas.width)\r\n}\r\n\r\nfunction createShader(gl: WebGLRenderingContext, type: GLenum, shaderCode: string): WebGLShader\r\n{\r\n    var shader:WebGLShader = gl.createShader(type);\r\n    gl.shaderSource(shader, shaderCode);\r\n    gl.compileShader(shader);\r\n    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if(success)\r\n    {\r\n        return shader;\r\n    }\r\n\r\n    console.error(\"编译Shader出错\", gl.getShaderInfoLog(shader));\r\n    gl.deleteShader(shader);\r\n    return null;\r\n}\r\n\r\n\r\nfunction createProgram(gl: WebGLRenderingContext, vs:WebGLShader, fs: WebGLShader):WebGLProgram\r\n{\r\n    var program:WebGLProgram = gl.createProgram();\r\n    gl.attachShader(program, vs);\r\n    gl.attachShader(program, fs);\r\n    gl.linkProgram(program);\r\n    var success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if(success)\r\n    {\r\n        return program;\r\n    }\r\n\r\n    console.error(\"WebGLProgram出错\", gl.getProgramInfoLog(program));\r\n    gl.deleteProgram(program);\r\n\r\n    return null;\r\n}\r\n\r\nfunction randomInit(min: number, max: number)\r\n{\r\n    return Math.floor(Math.random() * (max - min) + min);\r\n}\r\n\r\nfunction setTriangle(gl: WebGLRenderingContext)\r\n{\r\n    var w = randomInit(100, width * 0.3);\r\n    var h = randomInit(100, height * 0.3);\r\n    var x = randomInit(0, width - w);\r\n    var y = randomInit(0, height - h);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\r\n        x + randomInit(10, w), y + randomInit(10, h),\r\n        x + randomInit(10, w), y + randomInit(10, h),\r\n        x + randomInit(10, w), y + randomInit(10, h)\r\n    ]), gl.STATIC_DRAW)\r\n}\r\n\r\n\r\nasync function main()\r\n{\r\n    var vsCode = await Resource.LoadShaderAsync(\"res/shader/Screen.vs\");\r\n    var fsCode = await Resource.LoadShaderAsync(\"res/shader/ScreenNormalize.fs\");\r\n\r\n    createCanvas();\r\n    var vs = createShader(gl, gl.VERTEX_SHADER, vsCode);\r\n    var fs = createShader(gl, gl.FRAGMENT_SHADER, fsCode);\r\n    program = createProgram(gl, vs, fs);\r\n\r\n    var vertexs = [\r\n        0, 0.0,\r\n        200, 0.0,\r\n        0.0, 200\r\n    ];\r\n\r\n    var positionAttributeLocation:GLint = gl.getAttribLocation(program, \"a_position\");\r\n    var resolutionUniformLocation:WebGLUniformLocation = gl.getUniformLocation(program, \"u_resolution\");\r\n    var colorUniformLocation: WebGLUniformLocation = gl.getUniformLocation(program, \"u_color\");\r\n    var bufferData:WebGLBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, bufferData);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertexs), gl.STATIC_DRAW);\r\n\r\n\r\n    var speed = 0.01;\r\n    var val = 0;\r\n    var loop = ()=>\r\n    {\r\n        for(var i = 0; i < vertexs.length; i += 2)\r\n        {\r\n            vertexs[i] += speed; \r\n        }\r\n        val += speed;\r\n        if(val > 0.5 || val < 0.5)\r\n        {\r\n            speed *= -1;\r\n        }\r\n        resetSize();\r\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n        gl.clearColor(0, 0, 0, 0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n        gl.useProgram(program);\r\n        // gl.bindBuffer(gl.ARRAY_BUFFER, bufferData);\r\n        var size = 2;          // 每次迭代运行提取两个单位数据\r\n        var type = gl.FLOAT;   // 每个单位的数据类型是32位浮点型\r\n        var normalize = false; // 不需要归一化数据\r\n        var stride = 0;        // 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）\r\n                               // 每次迭代运行运动多少内存到下一个数据开始点\r\n        var offset = 0;        // 从缓冲起始位置开始读取\r\n\r\n        \r\n        gl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);\r\n\r\n        gl.enableVertexAttribArray(positionAttributeLocation);\r\n        gl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);\r\n\r\n        for(var i = 0; i < 5; i ++)\r\n        {\r\n            setTriangle(gl);\r\n\r\n            gl.drawArrays(gl.TRIANGLES, 0, vertexs.length / 2);\r\n            gl.uniform4f(colorUniformLocation, Math.random(), Math.random(), Math.random(), Math.random());\r\n        }\r\n\r\n\r\n\r\n        \r\n        requestAnimationFrame(loop);\r\n    }\r\n\r\n    requestAnimationFrame(loop);\r\n\r\n\r\n}\r\n\r\nmain();"],"names":[],"mappings":"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"}
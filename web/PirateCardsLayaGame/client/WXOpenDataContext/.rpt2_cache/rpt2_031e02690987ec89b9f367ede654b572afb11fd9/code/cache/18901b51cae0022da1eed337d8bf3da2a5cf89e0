{
  "code": "import { ui } from \"../ui/layaMaxUI\";\r\nexport default class BigRank extends ui.test.BigUI {\r\n    constructor() {\r\n        super();\r\n        this._key = 'score';\r\n        this.arr = [\r\n            { index: 1, avatarIP: 'test/4.png', UserName: \"测试用户1\", RankValue: 100 },\r\n            { index: 2, avatarIP: 'test/4.png', UserName: \"测试用户2\", RankValue: 75 },\r\n            { index: 3, avatarIP: 'test/4.png', UserName: \"测试用户3\", RankValue: 50 },\r\n            { index: 4, avatarIP: 'test/4.png', UserName: \"测试用户4\", RankValue: 25 }\r\n        ];\r\n    }\r\n    init() {\r\n        Laya.stage.addChild(this);\r\n        this.setlist(this.arr);\r\n        if (Laya.Browser.onMiniGame) {\r\n            wx.onMessage(this.recevieData.bind(this));\r\n            this.getFriendData();\r\n        }\r\n    }\r\n    getFriendData() {\r\n        var _$this = this;\r\n        wx.getFriendCloudStorage({\r\n            keyList: [this._key],\r\n            success: function (res) {\r\n                var listData;\r\n                var obj;\r\n                var kv;\r\n                var arr = [];\r\n                console.log('-----------------getFriendCloudStorage------------');\r\n                if (res.data) {\r\n                    for (var i = 0; i < res.data.length; i++) {\r\n                        obj = res.data[i];\r\n                        if (!(obj.KVDataList.length))\r\n                            continue;\r\n                        kv = obj.KVDataList[0];\r\n                        if (kv.key != _$this._key)\r\n                            continue;\r\n                        kv = JSON.parse(kv.value);\r\n                        listData = {};\r\n                        listData.avatarIP = obj.avatarUrl;\r\n                        listData.UserName = obj.nickname;\r\n                        listData.openID = obj.openid;\r\n                        listData.RankValue = kv.wxgame.value1;\r\n                        listData.update_time = kv.wxgame.update_time;\r\n                        arr.push(listData);\r\n                    }\r\n                    arr = arr.sort(function (a, b) {\r\n                        return b.RankValue - a.RankValue;\r\n                    });\r\n                    for (var i = 0; i < arr.length; i++) {\r\n                        arr[i].index = i + 1;\r\n                    }\r\n                    _$this.setlist(arr);\r\n                }\r\n            },\r\n            fail: function (data) {\r\n                console.log('------------------获取托管数据失败--------------------');\r\n                console.log(data);\r\n            }\r\n        });\r\n    }\r\n    recevieData(message) {\r\n        var _$this = this;\r\n        var type = message.type;\r\n        switch (type) {\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    setSelfData(data) {\r\n        var kvDataList = [];\r\n        var obj = {};\r\n        obj.wxgame = {};\r\n        obj.wxgame.value1 = data;\r\n        obj.wxgame.update_time = Laya.Browser.now();\r\n        kvDataList.push({ \"key\": this._key, \"value\": JSON.stringify(obj) });\r\n        wx.setUserCloudStorage({\r\n            KVDataList: kvDataList,\r\n            success: function (e) {\r\n                console.log('-----success:' + JSON.stringify(e));\r\n            },\r\n            fail: function (e) {\r\n                console.log('-----fail:' + JSON.stringify(e));\r\n            },\r\n            complete: function (e) {\r\n                console.log('-----complete:' + JSON.stringify(e));\r\n            }\r\n        });\r\n    }\r\n    setlist(arr) {\r\n        this._list.array = arr;\r\n        this._list.refresh();\r\n    }\r\n}\r\n",
  "references": [
    "D:/zengfeng/githubs/ihaiu.blog/web/PirateCardsLayaGame/client/WXOpenDataContext/src/ui/layaMaxUI.ts"
  ]
}

var laya=function(){"use strict";var e=Laya.VertexMesh,t=Laya.VertexDeclaration,a=Laya.VertexElement,i=Laya.VertexElementFormat;class r extends e{static getVertexDeclaration(e,r=!0){var s=this._declarationMap[e+(r?"_0":"_1")];if(!s){for(var n=e.split(","),o=0,l=[],h=0,d=n.length;h<d;h++){var _;switch(n[h]){case"POSITION":_=new a(o,i.Vector3,this.MESH_POSITION0),o+=12;break;case"NORMAL":_=new a(o,i.Vector3,this.MESH_NORMAL0),o+=12;break;case"COLOR":_=new a(o,i.Vector4,this.MESH_COLOR0),o+=16;break;case"UV":_=new a(o,i.Vector2,this.MESH_TEXTURECOORDINATE0),o+=8;break;case"UV1":_=new a(o,i.Vector4,this.MESH_TEXTURECOORDINATE1),o+=16;break;case"UV2":_=new a(o,i.Vector4,this.MESH_TEXTURECOORDINATE2),o+=16,console.log("UV2",_);break;case"BLENDWEIGHT":_=new a(o,i.Vector4,this.MESH_BLENDWEIGHT0),o+=16;break;case"BLENDINDICES":r?(_=new a(o,i.Vector4,this.MESH_BLENDINDICES0),o+=16):(_=new a(o,i.Byte4,this.MESH_BLENDINDICES0),o+=4);break;case"TANGENT":_=new a(o,i.Vector4,this.MESH_TANGENT0),o+=16,console.log("TANGENT",_);break;default:throw"VertexMesh: unknown vertex flag."}l.push(_)}s=new t(o,l),this._declarationMap[e+(r?"_0":"_1")]=s}return s}}r.MESH_TEXTURECOORDINATE2=6,r._declarationMap={};var s=Laya.IndexBuffer3D,n=Laya.VertexBuffer3D,o=Laya.HalfFloatUtils,l=Laya.Matrix4x4,h=Laya.SubMesh,d=Laya.IndexFormat,_=Laya.LayaGL;class u{static parse(e,t,a,i){u._mesh=a,u._subMeshes=i,u._version=t,u._readData=e,u.READ_DATA(),u.READ_BLOCK(),u.READ_STRINGS();for(var r=0,s=u._BLOCK.count;r<s;r++){u._readData.pos=u._BLOCK.blockStarts[r];var n=u._readData.getUint16(),o=u._strings[n],l=u["READ_"+o];if(null==l)throw new Error("model file err,no this function:"+n+" "+o);l.call(null)}u._mesh._bindPoseIndices=new Uint16Array(u._bindPoseIndices),u._bindPoseIndices.length=0,u._strings.length=0,u._readData=null,u._version=null,u._mesh=null,u._subMeshes=null}static _readString(){return u._strings[u._readData.getUint16()]}static READ_DATA(){u._DATA.offset=u._readData.getUint32(),u._DATA.size=u._readData.getUint32()}static READ_BLOCK(){for(var e=u._BLOCK.count=u._readData.getUint16(),t=u._BLOCK.blockStarts=[],a=u._BLOCK.blockLengths=[],i=0;i<e;i++)t.push(u._readData.getUint32()),a.push(u._readData.getUint32())}static READ_STRINGS(){var e=u._readData.getUint32(),t=u._readData.getUint16(),a=u._readData.pos;u._readData.pos=e+u._DATA.offset;for(var i=0;i<t;i++)u._strings[i]=u._readData.readUTFString();u._readData.pos=a}static READ_MESH(){var e,t=_.instance,a=0,i=(u._readString(),u._readData),h=i.__getBuffer(),E=i.getInt16(),T=u._DATA.offset;for(e=0;e<E;e++){var g,m,D,I=T+i.getUint32(),p=i.getUint32(),c=u._readString(),S=r.getVertexDeclaration(c,!1),f=S.vertexStride,R=c.split(","),C=R.length,y=u._mesh;switch(u._version){case"LAYAMODEL:05":case"LAYAMODEL:GPUSkining_05":case"LAYAMODEL:GPUSkining_06":g=h.slice(I,I+p*f),m=new Float32Array(g),D=new Uint8Array(g);break;case"LAYAMODEL:COMPRESSION_05":g=new ArrayBuffer(f*p),m=new Float32Array(g),D=new Uint8Array(g);var L=i.pos;i.pos=I;for(var O=0;O<p;O++)for(var M,P=O*f,A=0;A<C;A++)switch(R[A]){case"POSITION":m[M=P/4]=o.convertToNumber(i.getUint16()),m[M+1]=o.convertToNumber(i.getUint16()),m[M+2]=o.convertToNumber(i.getUint16()),P+=12;break;case"NORMAL":m[M=P/4]=i.getUint8()/127.5-1,m[M+1]=i.getUint8()/127.5-1,m[M+2]=i.getUint8()/127.5-1,P+=12;break;case"COLOR":m[M=P/4]=i.getUint8()/255,m[M+1]=i.getUint8()/255,m[M+2]=i.getUint8()/255,m[M+3]=i.getUint8()/255,P+=16;break;case"UV":case"UV1":m[M=P/4]=o.convertToNumber(i.getUint16()),m[M+1]=o.convertToNumber(i.getUint16()),P+=8;break;case"BLENDWEIGHT":m[M=P/4]=i.getUint8()/255,m[M+1]=i.getUint8()/255,m[M+2]=i.getUint8()/255,m[M+3]=i.getUint8()/255,P+=16;break;case"BLENDINDICES":D[P]=i.getUint8(),D[P+1]=i.getUint8(),D[P+2]=i.getUint8(),D[P+3]=i.getUint8(),P+=4;break;case"TANGENT":m[M=P/4]=i.getUint8()/127.5-1,m[M+1]=i.getUint8()/127.5-1,m[M+2]=i.getUint8()/127.5-1,m[M+3]=i.getUint8()/127.5-1,P+=16}i.pos=L}var N=new n(g.byteLength,t.STATIC_DRAW,!0);N.vertexDeclaration=S,N.setData(g);p=N._byteLength/S.vertexStride;y._indexFormat=p>65535?d.UInt32:d.UInt16,y._vertexBuffer=N,y._vertexCount+=p,a+=4*m.length}var x,b=T+i.getUint32(),U=i.getUint32();x=y.indexFormat==d.UInt32?new Uint32Array(h.slice(b,b+U)):new Uint16Array(h.slice(b,b+U));var F=new s(y.indexFormat,x.length,t.STATIC_DRAW,!0);F.setData(x),y._indexBuffer=F,y._setBuffer(y._vertexBuffer,F),a+=2*F.indexCount,y._setCPUMemory(a),y._setGPUMemory(a);var B=y._boneNames=[],G=i.getUint16();for(B.length=G,e=0;e<G;e++)B[e]=u._strings[i.getUint16()];var w=i.getUint32(),v=i.getUint32(),V=new Float32Array(h.slice(T+w,T+w+v)),k=V.length,H=y._inverseBindPosesBuffer=new ArrayBuffer(4*k);for(y._inverseBindPoses=[],e=0;e<k;e+=16){var W=new l(V[e+0],V[e+1],V[e+2],V[e+3],V[e+4],V[e+5],V[e+6],V[e+7],V[e+8],V[e+9],V[e+10],V[e+11],V[e+12],V[e+13],V[e+14],V[e+15],new Float32Array(H,4*e,16));y._inverseBindPoses[e/16]=W}return!0}static READ_SUBMESH(){var e=u._readData,t=e.__getBuffer(),a=new h(u._mesh);e.getInt16();var i=e.getUint32(),r=e.getUint32(),s=u._mesh._indexBuffer;a._indexBuffer=s,a._setIndexRange(i,r);var n=u._mesh._vertexBuffer;a._vertexBuffer=n;var o=u._DATA.offset,l=a._subIndexBufferStart,d=a._subIndexBufferCount,_=a._boneIndicesList,E=e.getUint16();l.length=E,d.length=E,_.length=E;for(var T=u._mesh._skinDataPathMarks,g=u._bindPoseIndices,m=u._subMeshes.length,D=0;D<E;D++){l[D]=e.getUint32(),d[D]=e.getUint32();for(var I=e.getUint32(),p=e.getUint32(),c=_[D]=new Uint16Array(t.slice(o+I,o+I+p)),S=0,f=c.length;S<f;S++){var R=c[S],C=g.indexOf(R);-1===C?(c[S]=g.length,g.push(R),T.push([m,D,S])):c[S]=C}}return u._subMeshes.push(a),!0}}u._BLOCK={count:0},u._DATA={offset:0,size:0},u._strings=[],u._bindPoseIndices=[];var E=Laya.Byte;class T{static read(e,t,a){var i=new E(e);i.pos=0;var r,s,n=i.readUTFString();switch("LAYAMODEL:GPUSkining_06"==n&&(r=new Laya.Vector3,s=new Laya.Vector3,r.x=i.readFloat32(),r.y=i.readFloat32(),r.z=i.readFloat32(),s.x=i.readFloat32(),s.y=i.readFloat32(),s.z=i.readFloat32()),n){case"LAYAMODEL:GPUSkining_05":case"LAYAMODEL:GPUSkining_06":u.parse(i,n,t,a);break;default:throw new Error("MeshReader: unknown mesh version.")}"LAYAMODEL:GPUSkining_06"==n&&(t._needUpdateBounds=!1,t.bounds.setMin(r),t.bounds.setMin(s)),t._setSubMeshes(a)}}class g extends Laya.Mesh{static _parse(e,t=null,a=null){var i=new g;return T.read(e,i,i._subMeshes),i}static LoadAsync(e){return new Promise(t=>{this.Load(e,e=>{t(e)})})}static Load(e,t){Laya.loader.load(e,Laya.Handler.create(this,a=>{if(a instanceof ArrayBuffer){var i=g._parse(a);i._url=Laya.URL.formatURL(e),Laya.Loader.clearRes(e),Laya.Loader.cacheRes(e,i),t(i)}else t(a)}),null,Laya.Loader.BUFFER)}destroy(){super.destroy()}}var m=Laya.Bounds,D=Laya.Vector3,I=Laya.Quaternion,p=Laya.Matrix4x4;class c{static ReadQuaternion(e){var t=new I;return t.x=e.readFloat32(),t.y=e.readFloat32(),t.z=e.readFloat32(),t.w=e.readFloat32(),t}static ReadVector3(e){var t=new D;return t.x=-1*e.readFloat32(),t.y=e.readFloat32(),t.z=e.readFloat32(),t}static ReadBounds(e){var t=this.ReadVector3(e),a=this.ReadVector3(e);return new m(t,a)}static ReadMatrix4x4(e){var t=e.readFloat32(),a=e.readFloat32(),i=e.readFloat32(),r=e.readFloat32(),s=e.readFloat32(),n=e.readFloat32(),o=e.readFloat32(),l=e.readFloat32(),h=e.readFloat32(),d=e.readFloat32(),_=e.readFloat32(),u=e.readFloat32(),E=e.readFloat32(),T=e.readFloat32(),g=e.readFloat32(),m=e.readFloat32(),D=new p(t,a,i,r,s,n,o,l,h,d,_,u,E,T,g,m),I=new p;return p.multiply(this.mm,D,I),I}}c.mm=new p(-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var S,f=Laya.Matrix4x4;class R{constructor(){this.boneIndex=-1,this.parentBoneIndex=-1,this._bindposeInvInit=!1}get BindposeInv(){return this._bindposeInv||(this._bindposeInv=new f,this.bindpose.invert(this._bindposeInv),this._bindposeInvInit=!0),this._bindposeInv}FromBytes(e){var t=new Laya.Byte(e);this.name=t.readUTFString(),this.guid=t.readUTFString(),this.isExposed=0!=t.readByte(),this.boneIndex=t.readInt32(),this.parentBoneIndex=t.readInt32(),this.bindpose=c.ReadMatrix4x4(t)}static CreateFromBytes(e){var t=new R;return t.FromBytes(e),t}}!function(e){e[e.Once=0]="Once",e[e.Loop=1]="Loop"}(S||(S={}));class C{constructor(){this.frameIndex=0,this.eventId=0}CompareTo(e){return this.frameIndex>e.frameIndex?-1:1}FromBytes(e){var t=new Laya.Byte(e);this.frameIndex=t.readInt32(),this.eventId=t.readInt32()}static CreateFromBytes(e){var t=new C;return t.FromBytes(e),t}}var y=Laya.Matrix4x4;class L{constructor(){this.rootMotionInvInit=!1}RootMotionInv(e){if(!this.rootMotionInvInit){let t=this.matrices[e];this.rootMotionInv=new y,t.invert(this.rootMotionInv),this.rootMotionInvInit=!0}return this.rootMotionInv}FromBytes(e,t){var a=new Laya.Byte(e);t&&(this.rootMotionDeltaPositionL=a.readFloat32(),this.rootMotionDeltaPositionQ=c.ReadQuaternion(a),this.rootMotionDeltaRotation=c.ReadQuaternion(a));var i=a.readUint32();this.matrices=[];for(var r=0;r<i;r++){var s=c.ReadMatrix4x4(a);this.matrices.push(s)}}static CreateFromBytes(e,t){var a=new L;return a.FromBytes(e,t),a}}var O,M=Laya.Byte;class P{constructor(){this.length=0,this.fps=0,this.wrapMode=S.Once,this.pixelSegmentation=0,this.rootMotionEnabled=!1,this.individualDifferenceEnabled=!1,this.frameCount=0,this.frameLastIndex=0}FromBytes(e){var t=new M(e);t.pos=0,this.name=t.readUTFString(),this.length=t.readFloat32(),this.fps=t.readUint32(),this.wrapMode=t.readInt32(),this.pixelSegmentation=t.readUint32(),this.rootMotionEnabled=0!=t.readByte(),this.individualDifferenceEnabled=0!=t.readByte();for(var a=t.readUint32(),i=t.readUint32(),r=[],s=0;s<a;s++){(o=[])[0]=t.readUint32(),o[1]=t.readUint32(),r.push(o)}var n=[];for(s=0;s<i;s++){var o;(o=[])[0]=t.readUint32(),o[1]=t.readUint32(),n.push(o)}var l=[];this.frames=l;for(s=0;s<a;s++){var h=(T=r[s])[0],d=T[1];t.pos=h;var _=t.readArrayBuffer(d),u=L.CreateFromBytes(_,this.rootMotionEnabled);l.push(u)}var E=[];this.events=E;for(s=0;s<i;s++){var T;h=(T=n[s])[0],d=T[1];t.pos=h;_=t.readArrayBuffer(d),u=C.CreateFromBytes(_);E.push(u)}this.frameCount=Math.floor(this.length*this.fps),this.frameLastIndex=this.frameCount-1}static CreateFromBytes(e){var t=new P;return t.FromBytes(e),t}}!function(e){e[e.Bone1=0]="Bone1",e[e.Bone2=1]="Bone2",e[e.Bone4=2]="Bone4"}(O||(O={}));var A,N,x=Laya.Byte;class b extends Laya.Resource{constructor(){super(...arguments),this.bonesCount=67,this.rootBoneIndex=0,this.textureWidth=0,this.textureHeight=0,this.sphereRadius=1,this.skinQuality=O.Bone4}FromBytes(e){var t=new x(e);t.pos=0,this.guid=t.readUTFString(),this.name=t.readUTFString(),this.rootBoneIndex=t.readInt16(),this.textureWidth=t.readUint32(),this.textureHeight=t.readUint32(),this.sphereRadius=t.readFloat32(),this.skinQuality=t.readInt32(),this.bonesCount=t.readUint32(),this.bounds=c.ReadBounds(t);for(var a=t.readUint32(),i=t.readUint32(),r=[],s=0;s<a;s++){(o=[])[0]=t.readUint32(),o[1]=t.readUint32(),r.push(o)}var n=[];for(s=0;s<i;s++){var o;(o=[])[0]=t.readUint32(),o[1]=t.readUint32(),n.push(o)}var l=[];this.clips=l;for(s=0;s<a;s++){var h=(T=r[s])[0],d=T[1];t.pos=h;var _=t.readArrayBuffer(d),u=P.CreateFromBytes(_);l.push(u)}var E=[];this.bones=E;for(s=0;s<i;s++){var T;h=(T=n[s])[0],d=T[1];t.pos=h,t.pos=h;_=t.readArrayBuffer(d),u=R.CreateFromBytes(_);E.push(u)}}static CreateFromBytes(e){var t=new x(e);t.pos=0;var a=t.readUTFString(),i=t.readUint32(),r=t.readArrayBuffer(i),s=new b;return s.version=a,s.FromBytes(r),s}static async LoadAsync(e){return new Promise(t=>{this.Load(e,e=>{t(e)})})}static Load(e,t){Laya.loader.load(e,Laya.Handler.create(this,a=>{if(null==a)return console.error("加载资源失败",e),void t(null);var i;a instanceof ArrayBuffer?((i=b.CreateFromBytes(a))._url=Laya.URL.formatURL(e),Laya.Loader.clearRes(e),Laya.Loader.cacheRes(e,i)):i=a,t&&t(i)}),null,Laya.Loader.BUFFER)}_disposeResource(){super._disposeResource()}destroy(){super.destroy()}}!function(e){e[e.AlwaysAnimate=0]="AlwaysAnimate",e[e.CullUpdateTransforms=1]="CullUpdateTransforms",e[e.CullCompletely=2]="CullCompletely"}(A||(A={}));class U{constructor(e){this.size=0,this.bufferIncrement=0,this.bufferIncrement=Math.max(1,e)}Get(e){return this.buffer[e]}Set(e,t){this.buffer[e]=t}AllocateMore(){let e=null!=this.buffer?new Array(this.buffer.length+this.bufferIncrement):new Array(this.bufferIncrement);null!=this.buffer&&this.size>0&&arrayCopyValue(this.buffer,e,!1),this.buffer=e}Clear(){this.size=0}Release(){this.size=0,this.buffer=null}Add(e){null!=this.buffer&&this.size!=this.buffer.length||this.AllocateMore(),this.buffer[this.size++]=e}AddRange(e){if(null==e)return;let t=e.length;if(0!=t)if(null==this.buffer)this.buffer=new Array(Math.max(this.bufferIncrement,t)),arrayCopyValue(e,this.buffer,!1),this.size=t;else{if(this.size+t>this.buffer.length){let i=new Array(Math.max(this.buffer.length+this.bufferIncrement,this.size+t));arrayCopyValue(this.buffer,i,!1),this.buffer=i;for(var a=0;a<t;a++)this.buffer[this.size+a]=e[a]}else for(a=0;a<t;a++)this.buffer[this.size+a]=e[a];this.size+=t}}RemoveAt(e){if(null!=this.buffer&&e>-1&&e<this.size){this.size--,this.buffer[e]=null;for(let t=e;t<this.size;++t)this.buffer[t]=this.buffer[t+1];this.buffer[this.size]=null}}Pop(){if(null==this.buffer||0==this.size)return null;--this.size;let e=this.buffer[this.size];return this.buffer[this.size]=null,e}Peek(){return null==this.buffer||0==this.size?null:this.buffer[this.size-1]}}class F{constructor(){this.frameCount=-1}CanBeExecute(){return this.frameCount!=Laya.timer.currFrame}MarkAsExecuted(){this.frameCount=Laya.timer.currFrame}}class B{constructor(){this.executeOncePerFrame=new F}Destroy(){this.material&&(this.material.destroy(),this.material=null)}}!function(e){e[e.RootOn_BlendOff=0]="RootOn_BlendOff",e[e.RootOn_BlendOn_CrossFadeRootOn=1]="RootOn_BlendOn_CrossFadeRootOn",e[e.RootOn_BlendOn_CrossFadeRootOff=2]="RootOn_BlendOn_CrossFadeRootOff",e[e.RootOff_BlendOff=3]="RootOff_BlendOff",e[e.RootOff_BlendOn_CrossFadeRootOn=4]="RootOff_BlendOn_CrossFadeRootOn",e[e.RootOff_BlendOn_CrossFadeRootOff=5]="RootOff_BlendOn_CrossFadeRootOff",e[e.Count=6]="Count"}(N||(N={}));var G=Laya.BoundSphere,w=Laya.Vector4,v=Laya.Vector3,V=Laya.Shader3D;class k{constructor(){this.anim=null,this.mesh=null,this.players=[],this.cullingGroup=null,this.cullingBounds=new U(100),this.mtrls=null,this.executeOncePerFrame=new F,this.time=0,k.Init()}get Time(){return this.time}set Time(e){this.time=e}static Init(){if(!this._isInited){this._isInited=!0;for(let e of this.keywords)this.keywordDefines.push(V.getDefineByName(e));this.ShaderDefine_SKIN_1=V.getDefineByName("SKIN_1"),this.ShaderDefine_SKIN_2=V.getDefineByName("SKIN_2"),this.ShaderDefine_SKIN_4=V.getDefineByName("SKIN_4"),this.shaderPropID_GPUSkinning_TextureMatrix=V.propertyNameToID("u_GPUSkinning_TextureMatrix"),this.shaderPropID_GPUSkinning_TextureSize_NumPixelsPerFrame=V.propertyNameToID("u_GPUSkinning_TextureSize_NumPixelsPerFrame"),this.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation=V.propertyNameToID("u_GPUSkinning_FrameIndex_PixelSegmentation"),this.shaderPropID_GPUSkinning_RootMotion=V.propertyNameToID("u_GPUSkinning_RootMotion"),this.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade=V.propertyNameToID("u_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade"),this.shaderPropID_GPUSkinning_RootMotion_CrossFade=V.propertyNameToID("u_GPUSkinning_RootMotion_CrossFade")}}Destroy(){if(null!=this.anim&&(this.anim.destroy(),this.anim=null),null!=this.mesh&&(this.mesh.destroy(),this.mesh=null),null!=this.mtrls){for(let e=0;e<this.mtrls.length;e++)this.mtrls[e].Destroy(),this.mtrls[e]=null;this.mtrls=null}null!=this.texture&&(this.texture.destroy(),this.texture=null),null!=this.players&&(this.players.length=0,this.players=null)}AddCullingBounds(){this.cullingBounds.Add(new G(new v(0,0,0),0))}RemoveCullingBounds(e){this.cullingBounds.RemoveAt(e)}LODSettingChanged(e){if(e.LODEnabled){let t=this.players,a=t.length;for(let i=0;i<a;i++)if(t[i].Player==e){let e=0;this.SetLODMeshByDistanceIndex(e,t[i].Player);break}}else e.SetLODMesh(null)}SetLODMeshByDistanceIndex(e,t){let a=null;if(0==e)a=this.mesh;else{let t=this.anim.lodMeshes;null==(a=null==t||0==t.length?this.mesh:t[Math.min(e-1,t.length-1)])&&(a=this.mesh)}t.SetLODMesh(a)}UpdateCullingBounds(){let e=this.players.length;for(let t=0;t<e;++t){let e=this.players[t];if(!e.isEnable)continue;if(!e.Player||!e.Player.Position)return void console.error("player.Player =null");let a=this.cullingBounds.Get(t);a.center=e.Player.Position,a.radius=this.anim.sphereRadius,this.cullingBounds[t]=a}}Update(e,t){if(this.executeOncePerFrame.CanBeExecute()&&(this.executeOncePerFrame.MarkAsExecuted(),this.time+=e),t.executeOncePerFrame.CanBeExecute()){let e=this.anim;t.executeOncePerFrame.MarkAsExecuted(),t.material._shaderValues.setTexture(k.shaderPropID_GPUSkinning_TextureMatrix,this.texture),t.material._shaderValues.setVector(k.shaderPropID_GPUSkinning_TextureSize_NumPixelsPerFrame,new w(e.textureWidth,e.textureHeight,3*e.bonesCount,0))}}UpdatePlayingData(e,t,a,i,r,s,n,o,l,h,d,_){if(t.setVector(k.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation,new w(i,a.pixelSegmentation,r,s)),o){let t=n.RootMotionInv(this.anim.rootBoneIndex);e.setMatrix4x4(k.shaderPropID_GPUSkinning_RootMotion,t)}this.IsCrossFadeBlending(l,d,_)&&(l.rootMotionEnabled&&e.setMatrix4x4(k.shaderPropID_GPUSkinning_RootMotion_CrossFade,l.frames[h].RootMotionInv(this.anim.rootBoneIndex)),console.log(t.__id,"frameIndex_crossFade",h,"CrossFadeBlendFactor",this.CrossFadeBlendFactor(_,d),a.name,"frameIndex=",i,"pixelSegmentation",a.pixelSegmentation),t.setVector(k.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade,new w(h,l.pixelSegmentation,this.CrossFadeBlendFactor(_,d))))}CrossFadeBlendFactor(e,t){return Mathf.Clamp01(e/t)}IsCrossFadeBlending(e,t,a){return null!=e&&t>0&&a<=t}GetMaterial(e){return this.mtrls[e]}InitMaterial(e,t){if(null!=this.mtrls)return;let a;switch(t){case O.Bone1:a=k.ShaderDefine_SKIN_1;break;case O.Bone2:a=k.ShaderDefine_SKIN_2;break;case O.Bone4:a=k.ShaderDefine_SKIN_4}let i=this.mtrls=[];for(let t=0;t<N.Count;++t){let r=new B,s=r.material=e.clone();s.lock=!0,s.__mname=e.__mname+" "+k.keywords[t],i[t]=r,s.name=k.keywords[t],s._shaderValues.addDefine(a),this.EnableKeywords(t,r)}}CloneMaterial(e,t){null==e&&console.error("GPUSkinningPlayerResources.CloneMaterial originalMaterial=null");let a,i=e.clone();switch(i.__mname=e.__mname+" CloneMaterial",t){case O.Bone1:a=k.ShaderDefine_SKIN_1;break;case O.Bone2:a=k.ShaderDefine_SKIN_2;break;case O.Bone4:a=k.ShaderDefine_SKIN_4}return i._shaderValues.addDefine(a),i._shaderValues.addDefine(k.keywordDefines[3]),i}EnableKeywords(e,t){for(let a=0;a<this.mtrls.length;++a)a==e?t.material._shaderValues.addDefine(k.keywordDefines[a]):t.material._shaderValues.removeDefine(k.keywordDefines[a])}}k.keywords=["ROOTON_BLENDOFF","ROOTON_BLENDON_CROSSFADEROOTON","ROOTON_BLENDON_CROSSFADEROOTOFF","ROOTOFF_BLENDOFF","ROOTOFF_BLENDON_CROSSFADEROOTON","ROOTOFF_BLENDON_CROSSFADEROOTOFF"],k.keywordDefines=[],k.shaderPropID_GPUSkinning_TextureMatrix=-1,k.shaderPropID_GPUSkinning_TextureSize_NumPixelsPerFrame=0,k.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation=0,k.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation_Last=0,k.shaderPropID_GPUSkinning_RootMotion=0,k.shaderPorpID_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade=0,k.shaderPropID_GPUSkinning_RootMotion_CrossFade=0,k._isInited=!1;class H{constructor(){this.items=[]}Register(e,t,a,i,r){if(null==e||null==a||null==i||null==r)return;let s=null,n=this.items,o=n.length;for(let t=0;t<o;++t)if(n[t].anim.guid==e.guid){s=n[t];break}return null==s&&(s=new k,n.push(s)),null==s.anim&&(s.anim=e),null==s.mesh&&(s.mesh=t),s.InitMaterial(a,e.skinQuality),null==s.texture&&(s.texture=i),-1==s.players.indexOf(r)&&(s.players.push(r),s.AddCullingBounds(),r.isEnable=!0),s}Unregister(e){if(null==e)return;let t=this.items,a=t.length;for(let i=0;i<a;++i){let a=t[i].players.indexOf(e);if(-1!=a){t[i].players.splice(a,1),t[i].RemoveCullingBounds(a),e.isEnable=!1,0==t[i].players.length&&(t[i].Destroy(),t.splice(i,1));break}}}}class W extends Laya.Script3D{constructor(){super(...arguments),this.index=0,this.BoneIndex=0,this.BoneGUID=null}get Transform(){return this.transform}get GameObject(){return this.go}onAwake(){this.go=this.owner,this.transform=this.go.transform}Init(e,t,a,i){this.bone=e,this.index=t,this.BoneIndex=a,this.BoneGUID=i}}var X=Laya.Vector3,z=Laya.Matrix4x4;class K{constructor(e,t){this.time=0,this.timeDiff=0,this.crossFadeTime=-1,this.crossFadeProgress=0,this.lastPlayedTime=0,this.lastPlayedClip=null,this.lastPlayingFrameIndex=-1,this.lastPlayingClip=null,this.playingClip=null,this.nextFrameIndex=-1,this.nextLerpProgress=0,this.res=null,this.rootMotionFrameIndex=-1,this.speed=1,this.sAnimEvent=new Typed2Signal,this.rootMotionEnabled=!1,this.cullingMode=A.CullUpdateTransforms,this.visible=!0,this.lodEnabled=!1,this.isPlaying=!1,this.jointMap=new Map,this.joints=null,this.__frameIndex=0,this.isRandomPlayClip=!1,this.randomPlayClipI=0,this.go=e,this.transform=e.transform,this.res=t,this.mr=e.meshRenderer,this.mf=e.meshFilter,this.spriteShaderData=e.meshRenderer._shaderValues,e.meshRenderer.__id=this.spriteShaderData.__id=K._ShaderUID++;let a=this.GetCurrentMaterial();this.mtrl=a;var i=new B;i.material=t.CloneMaterial(a.material,t.anim.skinQuality),a=i,this.mtrl=i,this.mr.sharedMaterial=null==a?null:a.material,this.mf.sharedMesh=t.mesh,this.ConstructJoints()}get RootMotionEnabled(){return this.rootMotionEnabled}set RootMotionEnabled(e){this.rootMotionFrameIndex=-1,this.rootMotionEnabled=e}get CullingMode(){return this.cullingMode}set CullingMode(e){this.cullingMode=e}get Visible(){return this.visible}set Visible(e){this.visible=e}get LODEnabled(){return this.lodEnabled}set LODEnabled(e){this.lodEnabled=e,this.res.LODSettingChanged(this)}get IsPlaying(){return this.isPlaying}get PlayingClipName(){return null==this.playingClip?null:this.playingClip.name}get Position(){return null==this.transform?new X:this.transform.position}get LocalPosition(){return null==this.transform?new X:this.transform.localPosition}get Joints(){return this.joints}get WrapMode(){return null==this.playingClip?S.Once:this.playingClip.wrapMode}get ClipTimeLength(){return this.playingClip?this.playingClip.length:0}get IsTimeAtTheEndOfLoop(){return null!=this.playingClip&&this.GetFrameIndex()==Math.floor(this.playingClip.length*this.playingClip.fps)-1}get NormalizedTime(){return null==this.playingClip?0:this.GetFrameIndex()/(Math.floor(this.playingClip.length*this.playingClip.fps)-1)}set NormalizedTime(e){if(null!=this.playingClip){var t=Mathf.Clamp01(e);this.WrapMode==S.Once?this.time=t*this.playingClip.length:this.WrapMode==S.Loop?this.playingClip.individualDifferenceEnabled?this.res.Time=this.playingClip.length+t*this.playingClip.length-this.timeDiff:this.res.Time=t*this.playingClip.length:console.error(`GPUSkinningPlayer.NormalizedTime 未知 播放模式 WrapMode=${this.WrapMode}`)}}GetCurrentTime(){let e=0;switch(this.WrapMode){case S.Once:e=this.time;break;case S.Loop:e=this.res.Time+(this.playingClip.individualDifferenceEnabled?this.timeDiff:0);break;default:console.error(`GPUSkinningPlayer.GetCurrentTime 未知 播放模式 WrapMode=${this.WrapMode}`)}return e}GetFrameIndex(){let e=this.GetCurrentTime();return this.playingClip.length==e?this.GetTheLastFrameIndex_WrapMode_Once(this.playingClip):this.GetFrameIndex_WrapMode_Loop(this.playingClip,e)}GetNextFrameIndex(e){var t=e,a=Math.floor(this.playingClip.length*this.playingClip.fps)-1;if(t==a)switch(this.WrapMode){case S.Once:t=a;break;case S.Loop:t=0;break;default:console.error(`GPUSkinningPlayer.GetNextFrameIndex 未知 播放模式 WrapMode=${this.WrapMode}`)}else t++;return t}GetCrossFadeFrameIndex(){if(null==this.lastPlayedClip)return 0;switch(this.lastPlayedClip.wrapMode){case S.Once:return this.lastPlayedTime>=this.lastPlayedClip.length?this.GetTheLastFrameIndex_WrapMode_Once(this.lastPlayedClip):this.GetFrameIndex_WrapMode_Loop(this.lastPlayedClip,this.lastPlayedTime);case S.Loop:return this.GetFrameIndex_WrapMode_Loop(this.lastPlayedClip,this.lastPlayedTime);default:console.error(`GPUSkinningPlayer.GetCrossFadeFrameIndex 未知 播放模式 this.lastPlayedClip.wrapMode=${this.lastPlayedClip.wrapMode}`)}}GetTheLastFrameIndex_WrapMode_Once(e){return e.frameLastIndex}GetFrameIndex_WrapMode_Loop(e,t){return Math.floor(t*e.fps)%Math.floor(e.length*e.fps)}GetCurrentMaterial(){if(null==this.res)return null;if(null==this.playingClip)return this.res.GetMaterial(N.RootOff_BlendOff);let e=this.res,t=this.playingClip,a=this.lastPlayedClip,i=this.rootMotionEnabled,r=this.crossFadeTime,s=this.crossFadeProgress;return t.rootMotionEnabled&&i?e.IsCrossFadeBlending(a,r,s)?a.rootMotionEnabled?e.GetMaterial(N.RootOn_BlendOn_CrossFadeRootOn):e.GetMaterial(N.RootOn_BlendOn_CrossFadeRootOff):e.GetMaterial(N.RootOn_BlendOff):e.IsCrossFadeBlending(a,r,s)?a.rootMotionEnabled?e.GetMaterial(N.RootOff_BlendOn_CrossFadeRootOn):e.GetMaterial(N.RootOff_BlendOn_CrossFadeRootOff):e.GetMaterial(N.RootOff_BlendOff)}SetLODMesh(e){this.LODEnabled||(e=this.res.mesh),null!=this.mf&&this.mf.sharedMesh!=e&&(this.mf.sharedMesh=e)}onDestroy(){this.mtrl&&(this.mtrl.Destroy(),this.mtrl=null)}ConstructJoints(){if(this.joints)return;this.jointMap.clear();let e=this.go.getComponentsInChildren(W),t=this.res.anim.bones,a=null==t?0:t.length;for(let i=0;i<a;i++){let a=t[i];if(!a.isExposed)continue;null==this.joints&&(this.joints=[]);let r=this.joints,s=!1;if(null!=e)for(let t=0;t<e.length;t++){let n=e[t];if(n&&n.BoneGUID==a.guid){n.index!=i&&n.Init(a,i,a.boneIndex,a.guid),n.GameObject.name=a.name,r.push(n),this.jointMap.set(a.name,n),e[t]=null,s=!0;break}}if(!s){let e=new Laya.Sprite3D(a.name);this.go.addChild(e),e.transform.localPosition=new X,e.transform.localScale=new X(1,1,1);let t=e.addComponent(W);t.onAwake(),r.push(t),t.Init(a,i,a.boneIndex,a.guid),this.jointMap.set(a.name,t)}}this.DeleteInvalidJoints(e)}DeleteInvalidJoints(e){if(e)for(let t=0;t<e.length;t++){let a=e[t];if(!a)continue;let i=a.owner;for(let e=i.numChildren-1;e>=0;e--){let t=i.getChildAt(e);this.go.addChild(t),t.transform.localPosition=new X}i.removeSelf(),i.destroy(),a.bone&&this.jointMap.delete(a.bone.name)}}FindJoint(e){return this.jointMap.has(e)?this.jointMap.get(e):null}FindJointGameObject(e){var t=this.FindJoint(e);return t?t.GameObject:null}Play(e,t=0){let a=this.res.anim.clips,i=null==a?0:a.length,r=this.playingClip;for(let s=0;s<i;++s)if(a[s].name==e){let e=a[s];return(r!=e||null!=r&&r.wrapMode==S.Once&&this.IsTimeAtTheEndOfLoop||null!=r&&!this.isPlaying)&&this.SetNewPlayingClip(e,t),void(this.time=t*e.length)}}CrossFade(e,t,a=0){this.Play(e,a)}SetNewPlayingClip(e,t=0){this.lastPlayedClip=this.playingClip,this.lastPlayedTime=this.GetCurrentTime(),this.isPlaying=!0,this.playingClip=e,this.rootMotionFrameIndex=-1,this.time=t*e.length,this.timeDiff=Random.range(0,e.length)}Stop(){this.isPlaying=!1}Resume(){null!=this.playingClip&&(this.isPlaying=!0)}Update(e){if(!this.isPlaying||null==this.playingClip)return;if(e*=this.speed,this.isRandomPlayClip&&(this.randomPlayClipI++,this.randomPlayClipI>=Random.range(100,500))){this.randomPlayClipI=0;var t=Random.range(0,this.res.anim.clips.length);t=Math.floor(t),this.Play(this.res.anim.clips[t].name)}let a=this.mtrl,i=this.playingClip;switch(i.wrapMode){case S.Loop:this.UpdateMaterial(e,a);break;case S.Once:this.time>=i.length?(this.time=i.length,this.UpdateMaterial(e,a)):(this.UpdateMaterial(e,a),this.time+=e,(this.time>i.length||this.__frameIndex==this.GetTheLastFrameIndex_WrapMode_Once(this.playingClip))&&(this.time=i.length));break;default:console.error(`GPUSkinningPlayer.Update 未知 播放模式 playingClip.wrapMode=${i.wrapMode}`)}this.crossFadeProgress+=e,this.lastPlayedTime+=e,this.lastPlayingClip=this.playingClip,this.lastPlayingFrameIndex=this.__frameIndex,this.nextFrameIndex=this.__frameIndex,this.nextLerpProgress+=e}onRenderUpdate(e,t,a){console.log(a.__id,"onRenderUpdate")}UpdateMaterial(e,t){let a=this.res,i=this.GetFrameIndex();this.__frameIndex=i,this.nextFrameIndex=this.GetNextFrameIndex(i),this.lastPlayingClip==this.playingClip&&this.lastPlayingFrameIndex==i||(this.nextLerpProgress=0);let r=this.lastPlayingClip,s=this.playingClip,n=1,o=-1,l=null;a.IsCrossFadeBlending(r,this.crossFadeTime,this.crossFadeProgress)&&(o=this.GetCrossFadeFrameIndex(),l=r.frames[o],n=a.CrossFadeBlendFactor(this.crossFadeProgress,this.crossFadeTime));let h=a.CrossFadeBlendFactor(this.nextLerpProgress,.001*s.fps);var d=t.material._shaderValues;let _=s.frames[i];(this.Visible||this.CullingMode==A.AlwaysAnimate)&&(a.Update(e,t),a.UpdatePlayingData(d,this.spriteShaderData,s,i,this.nextFrameIndex,h,_,s.rootMotionEnabled&&this.rootMotionEnabled,r,this.GetCrossFadeFrameIndex(),this.crossFadeTime,this.crossFadeProgress),this.UpdateJoints(_)),s.rootMotionEnabled&&this.rootMotionEnabled&&i!=this.rootMotionFrameIndex&&this.CullingMode!=A.CullCompletely&&(this.rootMotionFrameIndex=i,this.DoRootMotion(l,1-n,!1),this.DoRootMotion(_,n,!0)),this.UpdateEvents(s,i,null==l?null:r,o)}UpdateJoints(e){if(null==this.joints)return;let t=this.res,a=this.joints,i=this.playingClip,r=(e.matrices,t.anim.bones),s=a.length;for(let o=0;o<s;++o){let l=a[o],h=l.Transform;if(null!=h){var n=new z;if(z.multiply(e.matrices[l.index],r[l.index].BindposeInv,n),i.rootMotionEnabled&&this.rootMotionEnabled){let a=new z;z.multiply(e.RootMotionInv(t.anim.rootBoneIndex),n,a),n=a}h.localMatrix=n}else a.splice(o,1),--o,--s}}DoRootMotion(e,t,a){}UpdateEvents(e,t,a,i){this.UpdateClipEvent(e,t),this.UpdateClipEvent(a,i)}UpdateClipEvent(e,t){if(null==e||null==e.events||0==e.events.length)return;let a=e.events,i=a.length;for(let e=0;e<i;++e)if(a[e].frameIndex==t){this.sAnimEvent.dispatch(this,a[e].eventId);break}}}K._ShaderUID=0;class Q extends Laya.Script3D{constructor(){super(...arguments),this.isEnable=!1,this.defaultPlayingClipIndex=0,this.rootMotionEnabled=!1,this.lodEnabled=!0,this.cullingMode=A.CullUpdateTransforms}get Player(){return this.player}FindJointGameObject(e){return this.player?this.player.FindJointGameObject(e):null}_cloneTo(e){e.anim=this.anim,e.mesh=this.mesh,e.mtrl=this.mtrl,e.textureRawData=this.textureRawData,e.Init(),"Monster_2012_Laohu_Skin1"==e.anim.name&&console.log("GPUSkinningPlayerMono _cloneTo",e.anim.name),e.player&&(e.player.__mname?console.warn(e.player.__mname):e.player.__mname=e.anim.name+" _cloneTo Set")}onAwake(){}onEnable(){var e=null!=this.player;this.Init(),!e&&this.player&&(this.player.__mname?console.warn(this.player.__mname):this.player.__mname=this.anim.name+" onEnable Set"),this.isEnable=!0}onStart(){}onUpdate(){De.IsPauseAll||null!=this.player&&this.player.Update(Laya.timer.delta/1e3)}onPreRender(){}onDisable(){this.isEnable=!1}onDestroy(){Q.playerManager.Unregister(this),this.anim=null,this.mesh=null,this.mtrl=null,this.textureRawData=null,this.player&&(this.player.onDestroy(),this.player=null)}SetData(e,t,a,i){null==this.player&&(this.anim=e,this.mesh=t,this.mtrl=a,this.textureRawData=i,this.Init(),this.player&&(this.player.__mname?console.warn(this.player.__mname):this.player.__mname=e.name+" SetData Set"))}Init(){if(this.gameObject=this.owner,null!=this.player)return;let e=this.anim,t=this.mesh,a=this.mtrl,i=this.textureRawData;if(null!=e&&null!=t&&null!=a&&null!=i){let r=Q.playerManager.Register(e,t,a,i,this),s=new K(this.gameObject,r);s.RootMotionEnabled=this.rootMotionEnabled,s.LODEnabled=this.lodEnabled,s.CullingMode=this.cullingMode,this.player=s,null!=e&&null!=e.clips&&e.clips.length>0&&s.Play(e.clips[Mathf.clamp(this.defaultPlayingClipIndex,0,e.clips.length)].name)}}initRender(e){var t=e;t._renderUpdate__MeshRenderer__Source||(t._renderUpdate__MeshRenderer__Source=t._renderUpdate),t._renderUpdate=this._renderUpdate,t.onRenderUpdate=this.onRenderUpdate.bind(this)}onRenderUpdate(e,t,a){null!=this.player&&this.player.onRenderUpdate(e,t,a)}_renderUpdate(e,t){this.onRenderUpdate(e,t,this),this._renderUpdate__MeshRenderer__Source(e,t)}_renderUpdate__MeshRenderer__Source(e,t){}}Q.playerManager=new H;var j=Laya.Shader3D;class Y extends Laya.Material{static getShaderVS(e){return this.SHADER_PATH_ROOT+e+".vs"}static getShaderPS(e){return this.SHADER_PATH_ROOT+e+".fs"}static getShaderGLSL(e){return this.SHADER_PATH_ROOT+e+".glsl"}static async loadShaderGlslAsync(e){return(await this.loadAsync(this.getShaderGLSL(e),Laya.Loader.TEXT)).replace(/\r/g,"")}static async loadShaderVSAsync(e){return(await this.loadAsync(this.getShaderVS(e),Laya.Loader.TEXT)).replace(/\r/g,"")}static async loadShaderPSAsync(e){return(await this.loadAsync(this.getShaderPS(e),Laya.Loader.TEXT)).replace(/\r/g,"")}static async loadAsync(e,t){return new Promise(a=>{Laya.loader.load(e,Laya.Handler.create(null,e=>{a(e)}),null,t)})}static __initDefine__(){this.SHADERDEFINE_GPUSKINING_MATRIX_TEXTURE=j.getDefineByName("GPUSKINING_MATRIX_TEXTURE")}get GPUSkinning_TextureMatrix(){return this._shaderValues.getTexture(Y.GPUSKINING_MATRIX_TEXTURE)}set GPUSkinning_TextureMatrix(e){e?this._shaderValues.addDefine(Y.SHADERDEFINE_GPUSKINING_MATRIX_TEXTURE):this._shaderValues.removeDefine(Y.SHADERDEFINE_GPUSKINING_MATRIX_TEXTURE),this._shaderValues.setTexture(Y.GPUSKINING_MATRIX_TEXTURE,e)}}Y.SHADER_PATH_ROOT="res/shaders/GPUSkinning/",Y.GPUSKINING_MATRIX_TEXTURE=j.propertyNameToID("u_GPUSkinning_TextureMatrix");var J=Laya.Shader3D,Z=Laya.SubShader,$=Laya.VertexMesh,q=Laya.Vector4,ee=Laya.RenderState,te=Laya.Material;class ae extends Y{constructor(){super(),this._albedoColor=new q(1,1,1,1),this._albedoIntensity=1,this._enableVertexColor=!1,this.setShaderName(ae.shaderName),this._shaderValues.setVector(ae.ALBEDOCOLOR,new q(1,1,1,1)),this.renderMode=ae.RENDERMODE_OPAQUE}static async install(){this._isInstalled||(this._isInstalled=!0,ae.__initDefine__(),await ae.initShader(),ae.defaultMaterial=new ae,ae.defaultMaterial.lock=!0)}static async initShader(){var e,t,a,i,s,n=await ae.loadShaderVSAsync(ae.shaderName),o=await ae.loadShaderPSAsync(ae.shaderName);e={a_Position:$.MESH_POSITION0,a_Color:$.MESH_COLOR0,a_Texcoord0:$.MESH_TEXTURECOORDINATE0,a_Texcoord1:$.MESH_TEXTURECOORDINATE1,a_Texcoord2:r.MESH_TEXTURECOORDINATE2,a_MvpMatrix:$.MESH_MVPMATRIX_ROW0},t={u_GPUSkinning_TextureMatrix:J.PERIOD_MATERIAL,u_GPUSkinning_TextureSize_NumPixelsPerFrame:J.PERIOD_MATERIAL,u_GPUSkinning_RootMotion:J.PERIOD_MATERIAL,u_GPUSkinning_RootMotion_CrossFade:J.PERIOD_MATERIAL,u_GPUSkinning_FrameIndex_PixelSegmentation:J.PERIOD_SPRITE,u_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade:J.PERIOD_SPRITE,u_AlbedoTexture:J.PERIOD_MATERIAL,u_AlbedoColor:J.PERIOD_MATERIAL,u_TilingOffset:J.PERIOD_MATERIAL,u_AlphaTestValue:J.PERIOD_MATERIAL,u_MvpMatrix:J.PERIOD_SPRITE,u_FogStart:J.PERIOD_SCENE,u_FogRange:J.PERIOD_SCENE,u_FogColor:J.PERIOD_SCENE},a={s_Cull:J.RENDER_STATE_CULL,s_Blend:J.RENDER_STATE_BLEND,s_BlendSrc:J.RENDER_STATE_BLEND_SRC,s_BlendDst:J.RENDER_STATE_BLEND_DST,s_DepthTest:J.RENDER_STATE_DEPTH_TEST,s_DepthWrite:J.RENDER_STATE_DEPTH_WRITE},i=J.add(ae.shaderName,null,null,!0),s=new Z(e,t),i.addSubShader(s);s.addShaderPass(n,o,a)}static __initDefine__(){ae.SHADERDEFINE_ALBEDOTEXTURE=J.getDefineByName("ALBEDOTEXTURE"),ae.SHADERDEFINE_TILINGOFFSET=J.getDefineByName("TILINGOFFSET"),ae.SHADERDEFINE_ENABLEVERTEXCOLOR=J.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(e){if(this._albedoIntensity!==e){var t=this._shaderValues.getVector(ae.ALBEDOCOLOR);q.scale(this._albedoColor,e,t),this._albedoIntensity=e,this._shaderValues.setVector(ae.ALBEDOCOLOR,t)}}get _MainTex_STX(){return this._shaderValues.getVector(ae.TILINGOFFSET).x}set _MainTex_STX(e){var t=this._shaderValues.getVector(ae.TILINGOFFSET);t.x=e,this.tilingOffset=t}get _MainTex_STY(){return this._shaderValues.getVector(ae.TILINGOFFSET).y}set _MainTex_STY(e){var t=this._shaderValues.getVector(ae.TILINGOFFSET);t.y=e,this.tilingOffset=t}get _MainTex_STZ(){return this._shaderValues.getVector(ae.TILINGOFFSET).z}set _MainTex_STZ(e){var t=this._shaderValues.getVector(ae.TILINGOFFSET);t.z=e,this.tilingOffset=t}get _MainTex_STW(){return this._shaderValues.getVector(ae.TILINGOFFSET).w}set _MainTex_STW(e){var t=this._shaderValues.getVector(ae.TILINGOFFSET);t.w=e,this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(e){this.alphaTestValue=e}get albedoColorR(){return this._ColorR}set albedoColorR(e){this._ColorR=e}get albedoColorG(){return this._ColorG}set albedoColorG(e){this._ColorG=e}get albedoColorB(){return this._ColorB}set albedoColorB(e){this._ColorB=e}get albedoColorA(){return this._ColorA}set albedoColorA(e){this._ColorA=e}get albedoColor(){return this._albedoColor}set albedoColor(e){var t=this._shaderValues.getVector(ae.ALBEDOCOLOR);q.scale(e,this._albedoIntensity,t),this._albedoColor=e,this._shaderValues.setVector(ae.ALBEDOCOLOR,t)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(e){this._AlbedoIntensity=e}get albedoTexture(){return this._shaderValues.getTexture(ae.ALBEDOTEXTURE)}set albedoTexture(e){e?this._shaderValues.addDefine(ae.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(ae.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(ae.ALBEDOTEXTURE,e)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(e){this._MainTex_STX=e}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(e){this._MainTex_STY=e}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(e){this._MainTex_STZ=e}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(e){this._MainTex_STW=e}get tilingOffset(){return this._shaderValues.getVector(ae.TILINGOFFSET)}set tilingOffset(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(ae.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(ae.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(ae.TILINGOFFSET,e)}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(e){this._enableVertexColor=e,e?this._shaderValues.addDefine(ae.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(ae.SHADERDEFINE_ENABLEVERTEXCOLOR)}set renderMode(e){switch(e){case ae.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=te.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=ee.CULL_BACK,this.blend=ee.BLEND_DISABLE,this.depthTest=ee.DEPTHTEST_LESS;break;case ae.RENDERMODE_CUTOUT:this.renderQueue=te.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=ee.CULL_BACK,this.blend=ee.BLEND_DISABLE,this.depthTest=ee.DEPTHTEST_LESS;break;case ae.RENDERMODE_TRANSPARENT:this.renderQueue=te.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=ee.CULL_BACK,this.blend=ee.BLEND_ENABLE_ALL,this.blendSrc=ee.BLENDPARAM_SRC_ALPHA,this.blendDst=ee.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=ee.DEPTHTEST_LESS;break;default:throw new Error("GPUSkinningUnlitMaterial : renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(ae.DEPTH_WRITE)}set depthWrite(e){this._shaderValues.setBool(ae.DEPTH_WRITE,e)}get cull(){return this._shaderValues.getInt(ae.CULL)}set cull(e){this._shaderValues.setInt(ae.CULL,e)}get blend(){return this._shaderValues.getInt(ae.BLEND)}set blend(e){this._shaderValues.setInt(ae.BLEND,e)}get blendSrc(){return this._shaderValues.getInt(ae.BLEND_SRC)}set blendSrc(e){this._shaderValues.setInt(ae.BLEND_SRC,e)}get blendDst(){return this._shaderValues.getInt(ae.BLEND_DST)}set blendDst(e){this._shaderValues.setInt(ae.BLEND_DST,e)}get depthTest(){return this._shaderValues.getInt(ae.DEPTH_TEST)}set depthTest(e){this._shaderValues.setInt(ae.DEPTH_TEST,e)}clone(){var e=new ae;return this.cloneTo(e),e._albedoIntensity=this._albedoIntensity,this._albedoColor.cloneTo(e._albedoColor),this.lock,e}}ae.shaderName="GPUSkinningUnlit",ae._isInstalled=!1,ae.RENDERMODE_OPAQUE=0,ae.RENDERMODE_CUTOUT=1,ae.RENDERMODE_TRANSPARENT=2,ae.RENDERMODE_ADDTIVE=3,ae.ALBEDOTEXTURE=J.propertyNameToID("u_AlbedoTexture"),ae.ALBEDOCOLOR=J.propertyNameToID("u_AlbedoColor"),ae.TILINGOFFSET=J.propertyNameToID("u_TilingOffset"),ae.CULL=J.propertyNameToID("s_Cull"),ae.BLEND=J.propertyNameToID("s_Blend"),ae.BLEND_SRC=J.propertyNameToID("s_BlendSrc"),ae.BLEND_DST=J.propertyNameToID("s_BlendDst"),ae.DEPTH_TEST=J.propertyNameToID("s_DepthTest"),ae.DEPTH_WRITE=J.propertyNameToID("s_DepthWrite");var ie=Laya.Shader3D,re=Laya.SubShader,se=Laya.VertexMesh,ne=Laya.Vector4,oe=Laya.RenderState,le=Laya.Scene3DShaderDeclaration,he=Laya.Material;class de extends Y{constructor(){super(),this._albedoColor=new ne(1,1,1,1),this._albedoIntensity=1,this._enableVertexColor=!1,this.setShaderName(de.shaderName),this._albedoIntensity=1,this._shaderValues.setVector(de.ALBEDOCOLOR,new ne(1,1,1,1)),this._shaderValues.setVector(de.TILINGOFFSET,new ne(1,1,0,0)),this.CartoonShadowColor=new ne(.1764706,.1764706,.1764706,1),this.CartoonColorRange=.08,this.CartoonColorDeep=88.4,this.CartoonOutlineWidth=.004,this._shaderValues.setNumber(he.ALPHATESTVALUE,.5),this._enableLighting=!0,this.renderMode=de.RENDERMODE_OPAQUE}static async install(){this._isInstalled||(this._isInstalled=!0,de.__initDefine__(),await de.initShader(),de.defaultMaterial=new de,de.defaultMaterial.lock=!0)}static async initShader(){var e,t,a,i,s,n=await de.loadShaderVSAsync(de.shaderName),o=await de.loadShaderPSAsync(de.shaderName);e={a_Position:se.MESH_POSITION0,a_Color:se.MESH_COLOR0,a_Normal:se.MESH_NORMAL0,a_Texcoord0:se.MESH_TEXTURECOORDINATE0,a_Texcoord1:se.MESH_TEXTURECOORDINATE1,a_Texcoord2:r.MESH_TEXTURECOORDINATE2,a_MvpMatrix:se.MESH_MVPMATRIX_ROW0,a_WorldMat:se.MESH_WORLDMATRIX_ROW0},t={u_GPUSkinning_TextureMatrix:ie.PERIOD_MATERIAL,u_GPUSkinning_TextureSize_NumPixelsPerFrame:ie.PERIOD_MATERIAL,u_GPUSkinning_RootMotion:ie.PERIOD_MATERIAL,u_GPUSkinning_RootMotion_CrossFade:ie.PERIOD_MATERIAL,u_GPUSkinning_FrameIndex_PixelSegmentation:ie.PERIOD_SPRITE,u_GPUSkinning_FrameIndex_PixelSegmentation_Blend_CrossFade:ie.PERIOD_SPRITE,u_CartoonShadowColor:ie.PERIOD_MATERIAL,u_CartoonColorRange:ie.PERIOD_MATERIAL,u_CartoonColorDeep:ie.PERIOD_MATERIAL,u_CartoonOutlineWidth:ie.PERIOD_MATERIAL,u_AlbedoTexture:ie.PERIOD_MATERIAL,u_AlbedoColor:ie.PERIOD_MATERIAL,u_TilingOffset:ie.PERIOD_MATERIAL,u_AlphaTestValue:ie.PERIOD_MATERIAL,u_WorldMat:ie.PERIOD_SPRITE,u_MvpMatrix:ie.PERIOD_SPRITE,u_FogStart:ie.PERIOD_SCENE,u_FogRange:ie.PERIOD_SCENE,u_FogColor:ie.PERIOD_SCENE,u_DirationLightCount:ie.PERIOD_SCENE,u_LightBuffer:ie.PERIOD_SCENE,u_LightClusterBuffer:ie.PERIOD_SCENE,u_AmbientColor:ie.PERIOD_SCENE,"u_DirectionLight.color":ie.PERIOD_SCENE,"u_DirectionLight.direction":ie.PERIOD_SCENE,"u_PointLight.position":ie.PERIOD_SCENE,"u_PointLight.range":ie.PERIOD_SCENE,"u_PointLight.color":ie.PERIOD_SCENE,"u_SpotLight.position":ie.PERIOD_SCENE,"u_SpotLight.direction":ie.PERIOD_SCENE,"u_SpotLight.range":ie.PERIOD_SCENE,"u_SpotLight.spot":ie.PERIOD_SCENE,"u_SpotLight.color":ie.PERIOD_SCENE,u_CameraPos:ie.PERIOD_CAMERA},a={s_Cull:ie.RENDER_STATE_CULL,s_Blend:ie.RENDER_STATE_BLEND,s_BlendSrc:ie.RENDER_STATE_BLEND_SRC,s_BlendDst:ie.RENDER_STATE_BLEND_DST,s_DepthTest:ie.RENDER_STATE_DEPTH_TEST,s_DepthWrite:ie.RENDER_STATE_DEPTH_WRITE},i=ie.add(de.shaderName,null,null,!0),s=new re(e,t),i.addSubShader(s);s.addShaderPass(n,o,a)}static __initDefine__(){de.SHADERDEFINE_ALBEDOTEXTURE=ie.getDefineByName("ALBEDOTEXTURE"),de.SHADERDEFINE_TILINGOFFSET=ie.getDefineByName("TILINGOFFSET"),de.SHADERDEFINE_ENABLEVERTEXCOLOR=ie.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(e){this._albedoColor.x=e,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(e){this._albedoColor.y=e,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(e){this._albedoColor.z=e,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(e){this._albedoColor.w=e,this.albedoColor=this._albedoColor}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(e){if(this._albedoIntensity!==e){var t=this._shaderValues.getVector(de.ALBEDOCOLOR);ne.scale(this._albedoColor,e,t),this._albedoIntensity=e,this._shaderValues.setVector(de.ALBEDOCOLOR,t)}}get _MainTex_STX(){return this._shaderValues.getVector(de.TILINGOFFSET).x}set _MainTex_STX(e){var t=this._shaderValues.getVector(de.TILINGOFFSET);t.x=e,this.tilingOffset=t}get _MainTex_STY(){return this._shaderValues.getVector(de.TILINGOFFSET).y}set _MainTex_STY(e){var t=this._shaderValues.getVector(de.TILINGOFFSET);t.y=e,this.tilingOffset=t}get _MainTex_STZ(){return this._shaderValues.getVector(de.TILINGOFFSET).z}set _MainTex_STZ(e){var t=this._shaderValues.getVector(de.TILINGOFFSET);t.z=e,this.tilingOffset=t}get _MainTex_STW(){return this._shaderValues.getVector(de.TILINGOFFSET).w}set _MainTex_STW(e){var t=this._shaderValues.getVector(de.TILINGOFFSET);t.w=e,this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(e){this.alphaTestValue=e}get albedoColorR(){return this._ColorR}set albedoColorR(e){this._ColorR=e}get albedoColorG(){return this._ColorG}set albedoColorG(e){this._ColorG=e}get albedoColorB(){return this._ColorB}set albedoColorB(e){this._ColorB=e}get albedoColorA(){return this._ColorA}set albedoColorA(e){this._ColorA=e}get albedoColor(){return this._albedoColor}set albedoColor(e){var t=this._shaderValues.getVector(de.ALBEDOCOLOR);ne.scale(e,this._albedoIntensity,t),this._albedoColor=e,this._shaderValues.setVector(de.ALBEDOCOLOR,t)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(e){this._AlbedoIntensity=e}get albedoTexture(){return this._shaderValues.getTexture(de.ALBEDOTEXTURE)}set albedoTexture(e){e?this._shaderValues.addDefine(de.SHADERDEFINE_ALBEDOTEXTURE):this._shaderValues.removeDefine(de.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(de.ALBEDOTEXTURE,e)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(e){this._MainTex_STX=e}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(e){this._MainTex_STY=e}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(e){this._MainTex_STZ=e}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(e){this._MainTex_STW=e}get tilingOffset(){return this._shaderValues.getVector(de.TILINGOFFSET)}set tilingOffset(e){e&&(1!=e.x||1!=e.y||0!=e.z||0!=e.w)?this._shaderValues.addDefine(de.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(de.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(de.TILINGOFFSET,e)}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(e){this._enableVertexColor=e,e?this._shaderValues.addDefine(de.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(de.SHADERDEFINE_ENABLEVERTEXCOLOR)}set renderMode(e){switch(e){case de.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=he.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=oe.CULL_BACK,this.blend=oe.BLEND_DISABLE,this.depthTest=oe.DEPTHTEST_LESS;break;case de.RENDERMODE_CUTOUT:this.renderQueue=he.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=oe.CULL_BACK,this.blend=oe.BLEND_DISABLE,this.depthTest=oe.DEPTHTEST_LESS;break;case de.RENDERMODE_TRANSPARENT:this.renderQueue=he.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=oe.CULL_BACK,this.blend=oe.BLEND_ENABLE_ALL,this.blendSrc=oe.BLENDPARAM_SRC_ALPHA,this.blendDst=oe.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=oe.DEPTHTEST_LESS;break;default:throw new Error("GPUSkinningCartoonMaterial : renderMode value error.")}}get depthWrite(){return this._shaderValues.getBool(de.DEPTH_WRITE)}set depthWrite(e){this._shaderValues.setBool(de.DEPTH_WRITE,e)}get cull(){return this._shaderValues.getInt(de.CULL)}set cull(e){this._shaderValues.setInt(de.CULL,e)}get blend(){return this._shaderValues.getInt(de.BLEND)}set blend(e){this._shaderValues.setInt(de.BLEND,e)}get blendSrc(){return this._shaderValues.getInt(de.BLEND_SRC)}set blendSrc(e){this._shaderValues.setInt(de.BLEND_SRC,e)}get blendDst(){return this._shaderValues.getInt(de.BLEND_DST)}set blendDst(e){this._shaderValues.setInt(de.BLEND_DST,e)}get depthTest(){return this._shaderValues.getInt(de.DEPTH_TEST)}set depthTest(e){this._shaderValues.setInt(de.DEPTH_TEST,e)}get enableLighting(){return this._enableLighting}set enableLighting(e){this._enableLighting!==e&&(e?this._shaderValues.removeDefine(le.SHADERDEFINE_POINTLIGHT):this._shaderValues.addDefine(le.SHADERDEFINE_POINTLIGHT),this._enableLighting=e)}get CartoonShadowColor(){return this._cartoonShadowColor}set CartoonShadowColor(e){this._cartoonShadowColor=e,this._shaderValues.setVector(de.CARTOON_SHADOWCOLOR,e)}get CartoonColorRange(){return this._shaderValues.getNumber(de.CARTOON_CORLORRANGE)}set CartoonColorRange(e){e=Math.max(0,Math.min(2,e)),this._shaderValues.setNumber(de.CARTOON_CORLORRANGE,e)}get CartoonColorDeep(){return this._shaderValues.getNumber(de.CARTOON_CORLORDEEP)}set CartoonColorDeep(e){e=Math.max(-1,Math.min(100,e)),this._shaderValues.setNumber(de.CARTOON_CORLORDEEP,e)}get CartoonOutlineWidth(){return this._shaderValues.getNumber(de.CARTOON_OUTLINEWIDTH)}set CartoonOutlineWidth(e){this._shaderValues.setNumber(de.CARTOON_OUTLINEWIDTH,e)}clone(){var e=new de;return this.cloneTo(e),this._albedoColor.cloneTo(e._albedoColor),e}cloneTo(e){super.cloneTo(e);var t=e;t._enableLighting=this._enableLighting,t._albedoIntensity=this._albedoIntensity,t._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(t._albedoColor),this._cartoonShadowColor.cloneTo(t._cartoonShadowColor)}}de.shaderName="GPUSkinningCartoon",de._isInstalled=!1,de.RENDERMODE_OPAQUE=0,de.RENDERMODE_CUTOUT=1,de.RENDERMODE_TRANSPARENT=2,de.RENDERMODE_ADDTIVE=3,de.CARTOON_SHADOWCOLOR=ie.propertyNameToID("u_CartoonShadowColor"),de.CARTOON_CORLORRANGE=ie.propertyNameToID("u_CartoonColorRange"),de.CARTOON_CORLORDEEP=ie.propertyNameToID("u_CartoonColorDeep"),de.CARTOON_OUTLINEWIDTH=ie.propertyNameToID("u_CartoonOutlineWidth"),de.ALBEDOTEXTURE=ie.propertyNameToID("u_AlbedoTexture"),de.ALBEDOCOLOR=ie.propertyNameToID("u_AlbedoColor"),de.TILINGOFFSET=ie.propertyNameToID("u_TilingOffset"),de.CULL=ie.propertyNameToID("s_Cull"),de.BLEND=ie.propertyNameToID("s_Blend"),de.BLEND_SRC=ie.propertyNameToID("s_BlendSrc"),de.BLEND_DST=ie.propertyNameToID("s_BlendDst"),de.DEPTH_TEST=ie.propertyNameToID("s_DepthTest"),de.DEPTH_WRITE=ie.propertyNameToID("s_DepthWrite");class _e{static GetComponentsInChildren(e,t,a){a||(a=[]);for(let i=0,r=e.numChildren;i<r;i++){let r=e.getChildAt(i),s=r.getComponent(t);s&&a.push(s),this.GetComponentsInChildren(r,t,a)}return a}}class ue{constructor(){Laya.Node.prototype.getComponentsInChildren=this.getComponentsInChildren}static Init(){this.isInited||(this.isInited=!0,new ue)}getComponentsInChildren(e,t){return t?t.length=0:t=[],_e.GetComponentsInChildren(this,e,t),t}}ue.isInited=!1;var Ee=Laya.LoaderManager,Te=Laya.Loader,ge=Laya.Event,me=Laya.Shader3D;class De{static async InitAsync(){window.GPUSkining=De,window.GPUSkinningPlayerMonoManager=H,window.GPUSkinningPlayerMono=Q,window.GPUSkinningPlayerResources=k,window.GPUSkinningPlayer=K,window.GPUSkinningPlayerJoint=W,window.GPUSkiningMesh=g,window.GPUSkiningLoadModelV05=u,window.GPUSkiningVertexMesh=r,window.GPUSkinningBaseMaterial=Y,window.GPUSkinningUnlitMaterial=ae,window.GPUSkinningAnimation=b,window.GPUSkinningClip=P;var e=await Y.loadShaderGlslAsync("GPUSkinningInclude");me.addInclude("GPUSkinningInclude.glsl",e),Y.__initDefine__(),await ae.install(),await de.install(),ue.Init(),Laya3D.SKING_MESH="SKING_MESH",Ee.createMap.skinlm=[Laya3D.SKING_MESH,g._parse],Te.parserMap[Laya3D.SKING_MESH]=this._loadMesh}static _loadMesh(e){e.on(ge.LOADED,null,this._onMeshLmLoaded,[e]),e.load(e.url,Te.BUFFER,!1,null,!0)}static _onMeshLmLoaded(e,t){e._cache=e._createCache;var a=g._parse(t,e._propertyParams,e._constructParams);Laya3D._endLoad(e,a)}static GetAnimName(e){return`GPUSKinning_${e}_Anim.bin`}static GetMeshName(e){return`GPUSKinning_${e}_Mesh.bin`}static GetMatrixTextureName(e){return`GPUSKinning_${e}_MatrixTexture.bin`}static GetMainTextureName(e){return`GPUSKinning_${e}_MainTexture.png`}static GetPath(e){return this.resRoot+e}static LoadAnimTexture(e,t,a,i){Laya.loader.load(e,Laya.Handler.create(this,r=>{var s;if(r instanceof ArrayBuffer){var n=new Float32Array(r);(s=new Laya.Texture2D(t,a,Laya.TextureFormat.R32G32B32A32,!1,!0)).wrapModeU=Laya.BaseTexture.WARPMODE_CLAMP,s.wrapModeV=Laya.BaseTexture.WARPMODE_CLAMP,s.filterMode=Laya.BaseTexture.FILTERMODE_POINT,s.anisoLevel=0,s.lock=!0,s.setSubPixels(0,0,t,a,n,0),s._url=Laya.URL.formatURL(e),Laya.Loader.clearRes(e),Laya.Loader.cacheRes(e,s)}else s=r;i(s)}),null,Laya.Loader.BUFFER)}static LoadAnimTextureAsync(e,t,a){return new Promise(i=>{this.LoadAnimTexture(e,t,a,e=>{i(e)})})}static LoadAsync(e,t){return new Promise(a=>{Laya.loader.load(e,Laya.Handler.create(this,e=>{a(e)}),null,t)})}static Load3DAsync(e,t){return new Promise(a=>{Laya.loader.create(e,Laya.Handler.create(this,e=>{Laya.timer.frameOnce(1,this,()=>{a(e)})}),null,t)})}static async CreateByNameAsync(e,t,a,i){i||(i=ae);var r=this.GetPath(this.GetAnimName(e)),s=this.GetPath(this.GetMeshName(e)),n=this.GetPath(this.GetMatrixTextureName(e));null!=a&&""!=a||(a=this.GetPath(this.GetMainTextureName(e)));var o=await b.LoadAsync(r);if(null!=o){var l=await g.LoadAsync(s),h=await this.Load3DAsync(a,Laya.Loader.TEXTURE2D),d=await this.LoadAnimTextureAsync(n,o.textureWidth,o.textureHeight),_=new i;_.albedoTexture=h,_.GPUSkinning_TextureMatrix=d;var u=(new Laya.MeshSprite3D).addComponent(Q);return u.SetData(o,l,_,d),u}console.error("GPUSkinning资源加载失败",e)}static GetLoadItemList(e,t,a){var i=this.GetPath(this.GetAnimName(t)),r=this.GetPath(this.GetMeshName(t)),s=this.GetPath(this.GetMatrixTextureName(t));return null!=a&&""!=a||(a=this.GetPath(this.GetMainTextureName(t))),e||(e=[]),e.push(),e.push({url:i,type:Laya.Loader.BUFFER},{url:r,type:Laya.Loader.BUFFER},{url:s,type:Laya.Loader.BUFFER},{url:a,type:Laya.Loader.TEXTURE2D}),e}static CreateByName(e,t,a,i,r){r||(r=ae);var s=this.GetPath(this.GetAnimName(e)),n=this.GetPath(this.GetMeshName(e)),o=this.GetPath(this.GetMatrixTextureName(e));null!=i&&""!=i||(i=this.GetPath(this.GetMainTextureName(e))),b.Load(s,a=>{if(null==a)return console.error("GPUSkinning.CreateByName资源加载失败",s),void t.runWith(null);g.Load(n,s=>{if(null==s)return console.error("GPUSkinning.CreateByName资源加载失败",n),void t.runWith(null);this.LoadAnimTexture(o,a.textureWidth,a.textureHeight,n=>{null==n&&(console.error("GPUSkinning.CreateByName资源加载失败",o),t.runWith(null)),Laya.loader.create(i,Laya.Handler.create(this,o=>{null==o&&console.error("GPUSkinning.CreateByName资源加载失败",i);var l=new r;l.albedoTexture=o,l.GPUSkinning_TextureMatrix=n,l.__mname=e+" prefab";var h=(new Laya.MeshSprite3D).addComponent(Q);h.SetData(a,s,l,n),t.runWith(h)}),null,Laya.Loader.TEXTURE2D)})})})}}De.IsPauseAll=!1,De.EXT_SKING_MESH="skinlm",De.resRoot="res3d/Conventional/",window.GPUSkining=De;return window.GPUSkining=De,class{}}();